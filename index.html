<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>So Sánh 2 File</title>
</head>

<body>
    <div class="container">
        <h2 class="">Hiển thị danh sách trong Excel </h2>
        <form enctype="multipart/form-data">
            <input id="upload" type=file name="files">
            <input id="data" type=file name="da">
        </form>

        <!-- <textarea class="form-control" rows=35 cols=120 id="xlx_json"></textarea> -->
    </div>
    <style>
        .left{
            background-color: red;
        }
        .right{
            background-color: green;
        }

    </style>
    <div id="table"></div>
    <div id="tb">
     
    </div>
    <script>console.table()</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
    <script>
        var dataExcelOne = []
        var dataExcelTwo = []
        let ExcelToJSONDataOne = function () {
            this.parseExcel = function (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    let dataExcel = []
                    var data = e.target.result;
                    var workbook = XLSX.read(data, {
                        type: 'binary'
                    });
                    for (let index = 0; index < workbook.SheetNames.length; index++) {
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[workbook.SheetNames[index]]);
                        var json_object = JSON.stringify(XL_row_object);
                        dataExcel.push(JSON.parse(json_object));

                    }
                    dataExcelOne = dataExcel
                    ShowData()
                };


                reader.onerror = function (ex) {
                    console.log(ex, "ex");
                };

                reader.readAsBinaryString(file);
            };
        };

        let ExcelToJSONDataTwo = function () {
            this.parseExcel = function (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var data = e.target.result;
                    let dataExcel = []
                    var workbook = XLSX.read(data, {
                        type: 'binary'
                    });

                    for (let index = 0; index < workbook.SheetNames.length; index++) {
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[workbook.SheetNames[index]]);
                        var json_object = JSON.stringify(XL_row_object);
                        dataExcel.push(JSON.parse(json_object));

                    }
                    dataExcelTwo = dataExcel
                    ShowData()
                };

                reader.onerror = function (ex) {
                    console.log(ex);
                };

                reader.readAsBinaryString(file);
            };
        };

        document.getElementById('upload').addEventListener('change', function (evt) {
            var files = evt.target.files;
            var xl2json = new ExcelToJSONDataOne();
            xl2json.parseExcel(files[0]);

        });
        document.getElementById('data').addEventListener('change', function (evt) {
            var files = evt.target.files;
            var xl2json = new ExcelToJSONDataTwo();
            xl2json.parseExcel(files[0]);
        });

        function ShowData() {
            let dataExcelOneSheet1 = dataExcelOne[0]
            let dataExcelTwoSheet1 = dataExcelTwo[0]


            console.log(dataExcelOneSheet1)
            if (dataExcelOneSheet1 && dataExcelTwoSheet1) {
                let KeydataExcelOne = Object.keys(dataExcelOneSheet1[0])
                let KeydataExcelTwo = Object.keys(dataExcelTwoSheet1[0])
                let key_main = KeydataExcelOne[0]// key (STT , họ và tên , địa chỉ)
                let b = String(key_main)
                

                let dataExcelOneSheet1Length = dataExcelOneSheet1.length;
                let dataExcelTwoSheet1Length = dataExcelTwoSheet1.length;
                let dif = []
                let html = "<table border= '1|1'> "
                // for(let key in dataOne){}
                if (KeydataExcelOne.join() === KeydataExcelTwo.join()) {
                    if (dataExcelOneSheet1Length === dataExcelTwoSheet1Length || dataExcelOneSheet1Length > dataExcelTwoSheet1Length) {
                        html += "<tr>";
                        for(let i = 0 ; i < KeydataExcelOne.length; i++){
                               
                                html += "<th>"+ KeydataExcelOne[i]+"</th>";
                                // dif.push(KeydataExcelOne[i])

                            }
                            html += "</tr>";    
                        for (let item = 0; item < dataExcelOneSheet1.length; item++) {
                            let dataOne = dataExcelOneSheet1[item]
                            let dataTwo = dataExcelTwoSheet1[item]  
                            
                     
                            for (let key in dataOne) { // dong so 0
                                // stt , ho va ten , dia chi 
                             
                                html += "<tr>";

                                if (dataOne[key] !== dataTwo[key]) {
                                    dif.push(dataOne[key])
                                    dif.push(dataTwo[key])
                                    console.log(dataOne[key], dataTwo[key])
                                    console.log(key)
                                    
                                    
                                    html += "<td class ="+"tablejs"+" >" + dataOne.STT + "</td>";
                                    if(dataOne['Họ và tên'] == dataTwo['Họ và tên']){
                                        html += "<td>" + dataOne['Họ và tên'] + "</td>";
                                    }else{
                                    html += "<td role =" +"cell"+">" 
                                        +"<span class ="+"left"+">"+ dataOne['Họ và tên']+"</span>"
                                        + "<span class ="+"right"+">"+dataTwo['Họ và tên']+"</span>"+ "</td>";
                                    }
                                    if( dataOne['địa chỉ'] == dataTwo['địa chỉ']){
                                        html += "<td>" + dataOne['địa chỉ'] + "</td>";
                                    }else {
                                        html += "<td role ="+"cell"+">" 
                                            +"<span class ="+"left"+">"+ dataOne['địa chỉ'] +"</span>"
                                            +"<span class ="+"right"+">"+ dataTwo['địa chỉ']+ "</span>"+"</td>";
                                        dif.push(dataOne['địa chỉ']) 
                                        dif.push(dataTwo['địa chỉ'])
                                    }
                                    document.getElementById("table").innerHTML = html
                                    break;
                                }
                                // else {
                                //     html += "<td>" + dataOne.STT + "</td>";
                                //     html += "<td>" + dataOne[key] + "</td";
                                //     html += "<td>" + dataOne['địa chỉ'] + ","+dataTwo['địa chỉ']+"</td>";    
                                //     console.log(dataOne[key])    
                                // }
                                html += "</tr>";
                                console.log(dif)
                               
                            }
                            // for (let key in dataOne){
                            //     console.log(dataOne)
                            //     html += "<tr>";
                            //     html += "<td>" + dataOne[key] + "</td>";
                            //     html += "<tr>";    
                            // }
                            // document.getElementById("table").innerHTML = html

                        }

                    } else {
                        for (let item = 0; item < dataExcelTwoSheet1Length.length; item++) {
                            let dataOne = dataExcelOneSheet1[item]
                            let dataTwo = dataExcelTwoSheet1[item]
                            for (let key in dataOne) { // dong so 0
                                let html = ''
                                // stt , ho va ten , dia chi 
                                if (dataOne[key] !== dataTwo[key]) {
                                    // console.log(dataExcelTwoSheet1[item], dataExcelOneSheet1[item])
                                    console.log(KeydataExcelOne[0], ':', dataOne.STT)
                                    console.log(key, ":", dataOne[key], 'và', dataTwo[key])
                                    // break; 
                                }
                            }
                        }


                    }



                } else {
                    return "2 Bảng không trùng  khớp"
                }

            }




        }



    </script>
</body>

</html>